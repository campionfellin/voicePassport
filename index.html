<!DOCTYPE html>

<html>
	<head>
		<title>VoicePassport</title>
		<script src="index.js"></script>
		<script src="docusign3.js"></script>
		<script src="./public/js/recorder.js"></script>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
			<link rel="stylesheet" href="index.css">

	</head>
	<body>
		<p id="welcome">Welcome to VoicePassport</p>
		<button class="btn btn-default" onclick="nextButton()" id="nextButton">Next...</button>

		<p id="upload" class="hide">Upload Your Document</p>
			<input type="file" id="fileUpload" class="hide">
			<button class="hide" onclick="nextButton2()" id="nextButton2">Next...</button>

		</br>
		</br>
		<button onclick="startRecording(this)">Record</button>
		<button onclick="stopRecording(this)">Stop Recording</button>
		<button onclick="redirectToDocusign()" id="docusign" class="hide" hidden>Sign Document</button>
 	 	<ul id="recordingslist"></ul>

      <form action="signup.php" method="post" name="signup" hidden>
      <div class="input">
        <input type="text" class="button" id="email" name="number" placeholder="Enter your phone number &amp; choose your carrier" maxlength="10">
        <select class="button" id="carrier" name="carrier">
          <option value="" disabled selected>Carrier</option>
          <option value="vtext.com">Verizon</option>
          <option value="pm.sprint.com">Sprint</option>
          <option value="txt.att.net">Att&amp;t</option>
        </select>
        <input type="submit" class="button" id="submit" name="submit" value="SIGN UP">
      </div>
    </form>

		<script>
		var audio_context;
		var recorder;
		function startUserMedia(stream) {
			var input = audio_context.createMediaStreamSource(stream);
			console.log('Media stream created.');

			recorder = new Recorder(input);
			console.log('Recorder initialised.');
		}
		function startRecording(button) {
			recorder && recorder.record();
			button.disabled = true;
			button.nextElementSibling.disabled = false;
			console.log('Recording...');
		}
		function stopRecording(button) {
			recorder && recorder.stop();
			button.disabled = true;
			button.previousElementSibling.disabled = false;
			console.log('Stopped recording.');
			
			// create WAV download link using audio data blob
			createDownloadLink();
			
			recorder.clear();
		}
		function createDownloadLink() {
			recorder && recorder.exportWAV(function(blob) {
				var url = URL.createObjectURL(blob);
				var li = document.createElement('li');
				var au = document.createElement('audio');
				var hf = document.createElement('a');
				
				au.controls = true;
				au.src = url;
				hf.href = url;
				hf.download = new Date().toISOString() + '.wav';
				hf.innerHTML = hf.download;
				li.appendChild(au);
				li.appendChild(hf);
				recordingslist.appendChild(li);
			});
		}
		window.onload = function init() {
			try {
				window.AudioContext = window.AudioContext || window.webkitAudioContext;
				navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;

				window.URL = window.URL || window.webkitURL;
				
				audio_context = new AudioContext;
				console.log('Audio context set up.');
				console.log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
			} catch (e) {
				alert('No web audio support in this browser!', e);
			}
			
			navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
			});
		};
	</script>
	</body>
</html>
